<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Train Navi Overlay</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="panel">

  <div class="left">
    <div class="type" id="typeDisplay">各停</div>
    <button onclick="changeType()">種別</button>
  </div>

  <div class="center">
    <div class="next" id="nextStation">次駅：---</div>
    <select id="routeSelect" onchange="selectRoute()"></select>
    <button onclick="nextStation()">次駅へ</button>
  </div>

  <div class="right">
    列番：<input id="trainNo" value="4601A"><br><br>
    両数：<input id="cars" value="8">両<br><br>
    速度：<span id="speedVal">0</span>km/h<br>
    <input type="range" min="0" max="130"
      oninput="speedVal.textContent=this.value">
  </div>

</div>

<script>
let types = ["普通","区急","準急","急行","快急","臨時普通","臨時区急","臨時準急","臨時急行","臨時快急","A特急","B特急","C特急1","C特急2","C特急3","C特急4","D特急","臨時特急","回送"];
const typeColors = {
      "普通": "#000000",
      "区急": "#47ff1f",
      "準急": "#29f4ff",
      "急行": "#ffbb0a",
      "快急": "#aa0aff",
      "臨時普通": "#000000",
      "臨時区急": "#47ff1f"
      "臨時準急": "#29f4ff",
      "臨時急行": "#ffbb0a",
      "臨時快急": "#aa0aff",
      "A特急": "#ff0a0a",
      "B特急": "#ff0a0a",
      "C特急1": "#ff0a0a",
      "C特急1": "#ff0a0a",
      "C特急2": "#ff0a0a",
      "C特急3": "#ff0a0a",
      "C特急4": "#ff0a0a",
      "D特急": "#ff0a0a",
      "回送": "#ff8ae8",
    };
let typeIndex = 0;
let routes = {};
let currentRouteName = "";
let stationIndex = 0;

async function loadRoutes(){
  const res = await fetch("routes.json");
  routes = await res.json();
  for (let name in routes){
    let opt = document.createElement("option");
    opt.value = name;
    opt.textContent = name;
    routeSelect.appendChild(opt);
  }
  selectRoute();
}

function changeType(){
  typeIndex = (typeIndex + 1) % types.length;
  typeDisplay.textContent = types[typeIndex];
  stationIndex = 0;
  updateNextStation();
}

function selectRoute(){
  currentRouteName = routeSelect.value;
  stationIndex = 0;
  updateNextStation();
}

function nextStation(){
  const stations = getStations();
  stationIndex = (stationIndex + 1) % stations.length;
  updateNextStation();
}

function getStations(){
  const type = types[typeIndex];
  if (routes[currentRouteName][type])
    return routes[currentRouteName][type];
  return routes[currentRouteName]["各停"];
}

function updateNextStation(){
  document.getElementById("nextStation").textContent =
    "次駅：" + getStations()[stationIndex];
}

loadRoutes();
</script>
</body>
</html>
